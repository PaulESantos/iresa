% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ranking_iresa.R
\name{calcular_ranking_indicador}
\alias{calcular_ranking_indicador}
\title{Calcular Rankings por Indicador con Manejo de Empates}
\usage{
calcular_ranking_indicador(
  data,
  year = 2025,
  compare_with_2019 = TRUE,
  ascending = FALSE
)
}
\arguments{
\item{data}{Un data frame con datos del IRESA. Puede ser `calidad_ambiental`,
`gobernanza_gestion` o `iresa_general`.}

\item{year}{anio para el cual calcular el ranking. Por defecto 2025.}

\item{compare_with_2019}{Logico. Si es TRUE, calcula cambios respecto a 2019.
Por defecto TRUE.}

\item{ascending}{Logico. Si es TRUE, valores mas bajos obtienen mejor ranking
(posicion 1). Si es FALSE, valores mas altos obtienen mejor ranking.
Por defecto FALSE (valores altos = mejor).}
}
\value{
Un tibble con columnas:
  - `region`: Nombre de la region
  - `indicador`: Nombre del indicador (si aplica)
  - `indice_pilar`: Nombre del indice o pilar (si aplica)
  - `score_year`: Puntaje para el anio especificado
  - `rank_year`: Ranking recalculado para el anio especificado (con empates)
  - `score_2019`: Puntaje en 2019 (si compare_with_2019 = TRUE)
  - `rank_2019`: Ranking recalculado para 2019 (si compare_with_2019 = TRUE)
  - `cambio_score`: Diferencia de puntaje (si compare_with_2019 = TRUE)
  - `cambio_rank`: Diferencia de ranking (si compare_with_2019 = TRUE)
  - `tendencia`: Categoria del cambio (si compare_with_2019 = TRUE)
}
\description{
Genera rankings para indicadores del IRESA considerando empates y calculando
cambios respecto al anio base 2019. Los rankings se recalculan para todos los
anios disponibles para asegurar consistencia en el manejo de empates.
}
\details{
## Recalculo de rankings
La funcion SIEMPRE recalcula los rankings para todos los anios disponibles en
los datos, ignorando cualquier columna `rank_*` preexistente. Esto asegura:
- Manejo consistente de empates usando `dplyr::min_rank()`
- Comparaciones validas entre anios
- Rankings correctos segun la direccion especificada (ascending)

## Manejo de empates
Se usa `dplyr::min_rank()` que asigna el ranking mas bajo a todos los valores
empatados. Por ejemplo, si tres regiones empatan en el segundo lugar, todas
reciben ranking 2, y la siguiente region recibe ranking 5.

## Direccion del ranking
Algunos indicadores requieren rankings invertidos:
- **Valores altos = mejor** (ascending = FALSE): Tratamiento de aguas,
  acceso a agua, consumo de energias limpias, areas verdes, ejecucion de gasto
- **Valores bajos = mejor** (ascending = TRUE): Calidad del aire (PM2.5),
  generacion de residuos, degradacion de ecosistemas, conflictos, delitos,
  agua no facturada, viviendas informales, incendios

## Categorias de tendencia
- "Mejora significativa": Subio >=5 posiciones
- "Mejora": Subio 1-4 posiciones
- "Estable": Sin cambio de posicion
- "Deterioro": Bajo 1-4 posiciones
- "Deterioro significativo": Bajo >=5 posiciones
}
\examples{
\dontrun{
library(dplyr)

# Ranking de Calidad Ambiental para un indicador especifico
calidad_ambiental |>
  filter(indicador == "Acceso a agua segura") |>
  calcular_ranking_indicador(year = 2025)

# Ranking general IRESA sin comparar con 2019
iresa_general |>
  filter(indice_pilar == "IRESA") |>
  calcular_ranking_indicador(year = 2025, compare_with_2019 = FALSE)

# Ranking de calidad del aire (valores bajos = mejor)
calidad_ambiental |>
  filter(indicador == "Calidad del aire") |>
  calcular_ranking_indicador(year = 2025, ascending = TRUE)
}

}
